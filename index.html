<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DigitMarket - Digital Marketing Agency</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="digitmarket.css" />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <header>
      <div class="container">
        <h1 class="logo">DigitMarket</h1>
        <nav>
          <ul class="nav-links">
            <li><a href="#services">Services</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="container">
        <h2>Grow Your Business with DigitMarket</h2>
        <p>
          We help brands boost online presence and drive sales with targeted
          marketing strategies.
        </p>
        <a href="#contact" class="btn">Get Started</a>
      </div>
    </section>

    <section id="services" class="services">
      <div class="container">
        <h3>Our Services</h3>
        <div class="service-grid">
          <div class="service-card">
            <h4>SEO Optimization</h4>
            <p>
              Rank higher on Google and increase organic traffic with our proven
              SEO techniques.
            </p>
          </div>
          <div class="service-card">
            <h4>Social Media Marketing</h4>
            <p>
              Engage your audience and build brand loyalty across platforms like
              Instagram & Facebook.
            </p>
          </div>
          <div class="service-card">
            <h4>Google Ads</h4>
            <p>
              Get instant visibility with high-converting PPC campaigns managed
              by experts.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="about" class="about">
      <div class="container">
        <h3>Why Choose DigitMarket?</h3>
        <p>
          We are a team of passionate marketers focused on delivering measurable
          results and ROI-driven strategies tailored to your business goals.
        </p>
      </div>
    </section>

    <section id="contact" class="contact">
      <div class="container">
        <h3>Contact Us</h3>
        <form>
          <input type="text" placeholder="Your Name" required />
          <input type="email" placeholder="Your Email" required />
          <textarea placeholder="Your Message" required></textarea>
          <button type="submit" class="btn">Send Message</button>
        </form>
      </div>
    </section>

    <footer>
      <div class="container">
        <p>&copy; 2025 DigitMarket. All rights reserved.</p>
      </div>
    </footer>

    <!-- Chat Button -->
    <button id="chat-toggle-btn" aria-label="Open chat">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="white"
        viewBox="0 0 24 24"
        width="28"
        height="28"
      >
        <path
          d="M12 2a7 7 0 00-7 7v2a6.97 6.97 0 005 6.7V20a2 2 0 004 0v-2.3a6.97 6.97 0 005-6.7V9a7 7 0 00-7-7zm0 2a5 5 0 015 5v2a5 5 0 11-10 0V9a5 5 0 015-5zm-2 7a1 1 0 11-2 0 1 1 0 012 0zm6 0a1 1 0 11-2 0 1 1 0 012 0z"
        />
        <path
          d="M9 15c.5.6 1.5 1 3 1s2.5-.4 3-1"
          stroke="white"
          stroke-width="1.2"
          fill="none"
          stroke-linecap="round"
        />
      </svg>
    </button>

    <!-- Chat Widget -->
    <div
      class="chat-widget"
      role="region"
      aria-label="Chatbot"
      aria-hidden="true"
    >
      <div class="chat-header">
        <img
          src="./Image/Green Tree Illustration Happy World Enviroment Day Instagram Post .png"
          alt="Agent Avatar"
        />
        <div class="infhttps://i.pravatar.cc/100o">
          <h4>Couponfares Assistant</h4>
          <p>Ask Away !</p>
        </div>
        <button id="chat-close-btn" aria-label="Close chat">&times;</button>
      </div>

      <div class="chat-body" aria-live="polite" aria-relevant="additions">
        <div class="message bot" style="white-space: normal">
          Welcome to <b>CouponFares!</b> ✈️<br />How can we assist you today?
          <div class="quick-replies">
            <button class="quick-btn">White Label Travel Portal</button>
            <button class="quick-btn">Travel Agent</button>
            <button class="quick-btn">API XML</button>
            <button class="quick-btn">Supplier</button>
            <button class="quick-btn">Distributor</button>
          </div>
        </div>
      </div>

      <div class="chat-input">
        <input
          type="text"
          placeholder="Enter your message..."
          aria-label="Type your message"
        />
        <button id="send-btn" aria-label="Send message">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="white" d="M2 21l21-9L2 3v7l15 2-15 2v7z" />
          </svg>
        </button>
      </div>
    </div>

    <script>
      const toggleBtn = document.getElementById("chat-toggle-btn");
      const chatWidget = document.querySelector(".chat-widget");
      const closeBtn = document.getElementById("chat-close-btn");
      const input = document.querySelector(".chat-input input");
      const sendBtn = document.getElementById("send-btn");
      const chatBody = document.querySelector(".chat-body");

      // Manage clientId in localStorage
      let clientId = localStorage.getItem("chatbot_client_id");
      if (!clientId) {
        clientId = "id-" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("chatbot_client_id", clientId);
      }
      console.log("Client ID:", clientId);

      toggleBtn.addEventListener("click", () => {
        const isOpen = chatWidget.classList.contains("open");
        chatWidget.classList.toggle("open", !isOpen);
        chatWidget.setAttribute("aria-hidden", isOpen);
        if (!isOpen) input.focus();
      });

      closeBtn.addEventListener("click", () => {
        chatWidget.classList.remove("open");
        chatWidget.setAttribute("aria-hidden", "true");
        toggleBtn.focus();
      });

      function appendMessage(text, type = "bot") {
        const msg = document.createElement("div");
        msg.className = "message " + type;
        msg.innerHTML = text;
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      async function handleUserMessage(userMsg) {
        appendMessage(userMsg, "user");
        input.value = "";

        try {
          const response = await fetch(
            "https://skautomate.onrender.com/webhook/a9364bf8-11d7-4700-a177-d16209cbf1b6",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message: userMsg, clientId: clientId }),
            }
          );

          const data = await response.json();
          const reply = data.reply || "Sorry, I didn’t get that.";
          appendMessage(reply, "bot");
        } catch (error) {
          appendMessage("❌ Failed to connect to server.", "bot");
          console.error("Webhook error:", error);
        }
      }

      sendBtn.addEventListener("click", () => {
        const userMsg = input.value.trim();
        if (!userMsg) return;
        handleUserMessage(userMsg);
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendBtn.click();
      });

      // Handle quick button clicks
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("quick-btn")) {
          const text = e.target.textContent;
          handleUserMessage(text);
        }
      });
    </script>
  </body>
</html>
